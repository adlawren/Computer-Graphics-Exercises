The majority of this code was written by Dale Schuurmans, and was copied and pasted with his permission
